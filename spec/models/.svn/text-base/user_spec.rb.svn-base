require File.expand_path(File.dirname(__FILE__) + '/../spec_helper')

describe User do
  
  before(:all) do
    @user_group = UserGroup.new( :name => "Administrators"  )
  end
  
  before(:each) do
    @user = User.new( :username => "testuser", :password => "test", :password_confirmation => "test", :email => "test@test.de" )
    @user.user_groups << @user_group
  end
  
  it "should still exist after deleting" do
    @user.delete
    @user.should be_present
  end
  
  it "should have the deleted flag set after deleting" do
    @user.delete
    @user.deleted.should be_true
  end
  
  it "should belong to at least one usergroup" do
    @user.user_groups.should_not be_empty
  end
  
  it "should not have no backend language" do
    @user.backend_language.should_not be_nil
  end
  
  describe "validations" do
    
    it "should be valid with a username, a password and a salt" do
      @user.should be_valid
    end

    it "should not be valid without a username" do
      @user.username = ""
      @user.should_not be_valid
    end
    
    it "should not be valid without a password" do
      @user.password = ""
      @user.password_confirmation = ""
      @user.should_not be_valid
    end
    
    it "should have a password and the correct confirmation" do
      @user.should be_valid
      @user.password = "another_test"
      @user.should_not be_valid
    end

    it "should have a valid email adress" do
      @user.email = "test@test.de"
      @user.should be_valid
    end

    it "should have no invalid email adress" do
      @user.email = "hallo123"
      @user.should_not be_valid
      @user.email = "test@testing"
      @user.should_not be_valid
      @user.email = "test@.de"
      @user.should_not be_valid
    end
    
  end
  
end